<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>
  <div class="index">
    <%- include('./common/header.ejs',{ nickname: nickname, isAdmin: isAdmin }) %>
    <div class="container">
      <%- include('./common/menu.ejs', { isAdmin: isAdmin }) %>
      <div class="main">
          <form action="/user-manages.html" method="GET" class="searcharea">
            <input type="text" placeholder="输入用户昵称" name="nickname" class="nick">
            <input type="submit" value="搜索" id="search">
          </form>
          <table>
              <thead>
                  <tr>
                      <th>序号</th>
                      <th>用户名</th>
                      <th>用户昵称</th>
                      <th>手机号码</th>
                      <th>性别</th>
                      <th>年龄</th>
                      <th>是否是管理员</th>
                      <th>操作</th>
                  </tr>
              </thead>
              <tbody>
                  <!-- 循环 userList 显示用户数据 -->
                  <% for (var i=0;i<userList.length;i++){ %>
                        <tr>
                            <td><%= userList[i]._id %></td>
                            <td><%= userList[i].username %></td>
                            <td><%= userList[i].nickname %></td>
                            <td><%= userList[i].phone %></td>
                            <td><%= userList[i].sex || '-' %></td>
                            <td><%= userList[i].age || '-' %></td>
                            <td><%= parseInt(userList[i].is_admin) ? '是' : '否' %></td>
                            <td>
                                <!-- 
                                    如果当前登录的管理员跟这条记录匹配。那么可以修改
                                    如果这条记录是管理员记录的话，那么不可以删除 
                                 -->
                                <% if(userList[i].username === username){ %>
                                    <a href="#" class="update_btn">修改</a>
                                <% }else if(parseInt(userList[i].is_admin)){ %>
                                <% }else{ %>
                                    <a href="#" class="update_btn">修改</a>
                                    <a href="users/delete?_id=<%= userList[i]._id %>">删除</a>
                                <% } %>
                            </td>
                        </tr>
                    <% } %>
              </tbody>
          </table>
          <!-- 通过传过来 totalPage 来渲染分页组件 -->
          <ul class="pagination">
                <li>
                    <a href="#" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>
            <% for(var i=0;i<totalPage;i++){ %>
                <li>
                    <a href="/user-manages.html?page=<%= i + 1 %>"><%= i+1 %>页</a>
                </li>
            <% } %>
                <li>
                    <a href="#" aria-label="Next">
                      <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
          </ul>
      </div>
      <div id="update">
        <h2>修改</h2>
        <form action="/users/update" method="GET">
            <div class="form-group">
                <label>用户名：</label>
                <input type="text" name="username" class="form-control">
            </div>
            <div class="form-group">
                <label>昵称：</label>
                <input type="text" name="nickname" class="form-control">
            </div>
            <div class="form-group">
                <label>手机号码：</label>
                <input type="text" name="phone" class="form-control">
            </div>
            <div class="form-group">
                <label>性别：</label>
                <input type="radio" name="sex" value="1" checked>男
                <input type="radio" name="sex" value="0">女
            </div>
            <div class="form-group">
                <label>年龄：</label>
                <input type="text" name="age" class="form-control">
            </div>
            <input type="submit" class="sure" value="确定">
            <div class="cancel">取消</div>
            <input type="hidden" name="id">
        </form>
      </div>
    </div>
  </div>
</body>
</html>
<script src="/lib/jquery/jquery.min.js"></script>
<script>
    $("table").delegate(".update_btn","click",function(){
        $("#update").show();
        $("input[name='username']").val($(this).parent().parent().children("td:nth-child(2)").html());
        $("input[name='nickname']").val($(this).parent().parent().children("td:nth-child(3)").html());
        $("input[name='phone']").val($(this).parent().parent().children("td:nth-child(4)").html());
        $("input[name='age']").val($(this).parent().parent().children("td:nth-child(6)").html());
        $("input[name='id']").val($(this).parent().parent().children("td:nth-child(1)").html());
    });
    $(".cancel").click(function(){
        $("#update").hide();
    })
</script>
    